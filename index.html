<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–°–†–û –¢–ï–†–ú v3 | –¢–ï–†–ú–ò–ù–ê–õ –ö–û–ù–¢–†–û–õ–Ø –°–¢–†–û–ò–¢–ï–õ–¨–°–¢–í–ê</title>
    
    <style>
        :root {
            /* –°–≤–µ—Ç–ª–∞—è —Ç–µ–º–∞ */
            --bg: #f8fafc;
            --surface: #ffffff;
            --surface-light: #f1f5f9;
            --border: #e2e8f0;
            --text-main: #334155;
            --text-dim: #64748b;
            --text-bright: #0f172a;
            
            /* Terminal Status Colors - –º–∏–Ω–∏–º–∞–ª–∏—Å—Ç–∏—á–Ω—ã–µ */
            --terminal-ok: #10b981;
            --terminal-warning: #f59e0b;
            --terminal-error: #ef4444;
            --terminal-info: #64748b; /* –°–µ—Ä—ã–π –≤–º–µ—Å—Ç–æ —Å–∏–Ω–µ–≥–æ */
            
            /* Financial Colors */
            --green: #10b981;
            --green-dark: #047857;
            --red: #ef4444;
            --red-dark: #b91c1c;
            --yellow: #f59e0b;
            --orange: #f97316;
            
            /* Chart Colors */
            --chart-line: #10b981;
            --chart-fill: rgba(16, 185, 129, 0.1);
            --chart-limit: rgba(239, 68, 68, 0.2);
            
            /* Top bar colors */
            --top-bar-bg: #0f172a;
            --top-bar-text: #ffffff;
            --top-bar-border: #1e293b;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'JetBrains Mono', 'Cascadia Code', 'Fira Code', monospace;
        }

        body {
            background: var(--bg);
            color: var(--text-main);
            height: 100vh;
            overflow: hidden;
            font-size: 11px;
            line-height: 1.3;
            letter-spacing: -0.3px;
        }

        /* MAIN GRID */
        .app-grid {
            display: grid;
            grid-template-rows: 40px 1fr 180px;
            grid-template-columns: 250px 1fr;
            height: 100vh;
            gap: 1px;
            background: var(--border);
        }

        /* TOP BAR - –ö–æ–Ω—Ç—Ä–∞—Å—Ç–Ω–∞—è */
        .top-bar {
            grid-column: 1 / -1;
            background: var(--top-bar-bg);
            border-bottom: 1px solid var(--top-bar-border);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 16px;
            color: var(--top-bar-text);
        }

        .terminal-prompt {
            color: var(--terminal-ok);
            font-weight: 600;
        }

        .live-indicator {
            width: 8px;
            height: 8px;
            background: var(--terminal-ok);
            border-radius: 50%;
            animation: pulse 1.5s infinite;
            margin-right: 8px;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }

        /* AGENT SIDEBAR */
        .agent-sidebar {
            grid-row: 2 / 4;
            background: var(--surface);
            border-right: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            width: 250px;
        }

        .agent-header {
            padding: 8px 12px;
            background: var(--top-bar-bg);
            color: #e2e8f0;
            font-weight: 600;
            font-size: 10px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            display: flex;
            align-items: center;
            gap: 6px;
            height: 32px;
            border-bottom: 1px solid var(--top-bar-border);
        }

        .agent-avatar {
            width: 18px;
            height: 18px;
            background: var(--terminal-info);
            color: white;
            border-radius: 3px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 9px;
        }

        .agent-messages {
            flex: 1;
            padding: 8px;
            overflow-y: auto;
            min-height: 120px;
        }

        .agent-message {
            background: var(--surface-light);
            border: 1px solid var(--border);
            border-radius: 4px;
            padding: 8px;
            margin-bottom: 6px;
            font-size: 9px;
            animation: slideIn 0.3s ease-out;
            position: relative;
            overflow: hidden;
        }

        @keyframes slideIn {
            from { transform: translateX(-10px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        .agent-message.system {
            border-left: 3px solid var(--terminal-warning);
        }

        .agent-message.critical {
            border-left: 3px solid var(--terminal-error);
        }

        .agent-message.info {
            border-left: 3px solid var(--terminal-ok);
        }

        .agent-message.updating::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 2px;
            background: linear-gradient(90deg, var(--terminal-ok), var(--terminal-warning), var(--terminal-ok));
            animation: progressBar 4s linear infinite;
        }

        @keyframes progressBar {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        .agent-actions {
            padding: 8px;
            border-top: 1px solid var(--border);
            min-height: 100px;
        }

        .agent-action-btn {
            width: 100%;
            background: var(--surface-light);
            border: 1px solid var(--border);
            color: var(--text-main);
            padding: 6px 8px;
            border-radius: 3px;
            font-size: 9px;
            cursor: pointer;
            margin-bottom: 4px;
            transition: all 0.2s;
            text-align: left;
            position: relative;
            overflow: hidden;
        }

        .agent-action-btn:hover {
            background: var(--surface);
            border-color: var(--terminal-info);
        }

        .agent-action-btn::before {
            content: "$ ";
            color: var(--terminal-ok);
        }

        .agent-action-btn.executing::after {
            content: ' ‚ñ∏';
            color: var(--terminal-ok);
            animation: blink 1s infinite;
        }

        /* MAIN AREA */
        .main-area {
            grid-row: 2;
            background: var(--surface);
            display: grid;
            grid-template-rows: auto 1fr auto;
            overflow: hidden;
        }
        
        .tabs-container {
            overflow-y: auto;
            position: relative;
            min-height: 0;
        }
        
        .tabs-container::-webkit-scrollbar {
            width: 2px;
        }
        
        .tabs-container::-webkit-scrollbar-track {
            background: transparent;
        }
        
        .tabs-container::-webkit-scrollbar-thumb {
            background: rgba(100, 116, 139, 0.3);
            border-radius: 1px;
        }
        
        .tabs-container::-webkit-scrollbar-thumb:hover {
            background: rgba(100, 116, 139, 0.5);
        }
        
        .terminal-wrapper {
            display: flex;
            flex-direction: column;
            min-height: 0;
        }

        .table-tabs {
            display: flex;
            background: var(--top-bar-bg);
            border-bottom: 1px solid var(--top-bar-border);
        }

        .table-tab {
            padding: 8px 16px;
            font-size: 10px;
            cursor: pointer;
            border-right: 1px solid var(--top-bar-border);
            color: #94a3b8;
            transition: all 0.2s;
        }

        .table-tab:hover {
            background: #1e293b;
            color: #cbd5e1;
        }

        .table-tab.active {
            background: #1e293b;
            color: #f1f5f9;
            border-bottom: 2px solid var(--terminal-ok);
            font-weight: 600;
        }

        .table-container {
            flex: 1;
            overflow: auto;
        }

        /* TAB CONTENT */
        .tab-content {
            display: none;
            padding: 16px;
            overflow-y: auto;
        }
        
        .tab-content::-webkit-scrollbar {
            width: 2px;
        }
        
        .tab-content::-webkit-scrollbar-track {
            background: transparent;
        }
        
        .tab-content::-webkit-scrollbar-thumb {
            background: rgba(100, 116, 139, 0.3);
            border-radius: 1px;
        }
        
        .tab-content::-webkit-scrollbar-thumb:hover {
            background: rgba(100, 116, 139, 0.5);
        }

        .tab-content.active {
            display: block;
        }

        /* DYNAMIC DATA HIGHLIGHTS */
        .dynamic-value {
            position: relative;
            padding: 2px 4px;
            border-radius: 2px;
            animation: highlightUpdate 4s ease-in-out infinite;
        }

        @keyframes highlightUpdate {
            0%, 100% { background: transparent; }
            10%, 30% { background: rgba(16, 185, 129, 0.1); }
        }

        .dynamic-number {
            font-weight: 600;
            position: relative;
            display: inline-block;
            min-width: 40px;
            text-align: right;
        }

        .dynamic-number.updating::after {
            content: '‚Üª';
            position: absolute;
            right: -12px;
            top: 0;
            font-size: 8px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        /* TABLE */
        .dense-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 10px;
        }

        .dense-table th {
            position: sticky;
            top: 0;
            background: var(--surface-light);
            color: var(--text-dim);
            font-weight: 600;
            text-transform: uppercase;
            padding: 8px 6px;
            text-align: right;
            border-bottom: 2px solid var(--border);
            font-size: 9px;
            letter-spacing: 0.5px;
        }

        .dense-table th:first-child {
            text-align: center;
            width: 40px;
        }

        .dense-table th:nth-child(2),
        .dense-table th:nth-child(3) {
            text-align: left;
        }

        .dense-table td {
            padding: 6px 6px;
            border-bottom: 1px solid rgba(226, 232, 240, 0.8);
            text-align: right;
            color: var(--text-main);
            transition: background 0.2s;
        }

        .dense-table td:nth-child(2),
        .dense-table td:nth-child(3) {
            text-align: left;
        }

        .dense-table tr:hover td {
            background: rgba(0, 0, 0, 0.02);
        }

        .dense-table tr.selected td {
            background: rgba(100, 116, 139, 0.08);
        }

        /* STATUS INDICATORS */
        .status-dot {
            display: inline-block;
            width: 6px;
            height: 6px;
            border-radius: 50%;
            margin-right: 4px;
            animation: pulseDot 4s infinite;
        }

        @keyframes pulseDot {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .status-ok { background: var(--terminal-ok); }
        .status-warning { background: var(--terminal-warning); }
        .status-critical { background: var(--terminal-error); }

        /* BADGES */
        .badge {
            padding: 2px 6px;
            border-radius: 3px;
            font-size: 8px;
            font-weight: 600;
            letter-spacing: 0.3px;
            animation: badgePulse 4s infinite;
        }

        @keyframes badgePulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .badge-success {
            background: rgba(16, 185, 129, 0.1);
            color: var(--terminal-ok);
            border: 1px solid rgba(16, 185, 129, 0.2);
        }

        .badge-warning {
            background: rgba(245, 158, 11, 0.1);
            color: var(--terminal-warning);
            border: 1px solid rgba(245, 158, 11, 0.2);
        }

        .badge-error {
            background: rgba(239, 68, 68, 0.1);
            color: var(--terminal-error);
            border: 1px solid rgba(239, 68, 68, 0.2);
        }

        /* INPUTS */
        .term-input {
            background: var(--surface-light);
            border: 1px solid var(--border);
            color: var(--text-bright);
            padding: 4px 8px;
            border-radius: 3px;
            font-size: 11px;
            min-width: 60px;
            text-align: right;
        }

        .term-input:focus {
            outline: none;
            border-color: var(--terminal-info);
            box-shadow: 0 0 0 2px rgba(100, 116, 139, 0.1);
        }

        /* ANALYSIS PANEL */
        .analysis-panel {
            grid-row: 3;
            grid-column: 2;
            background: var(--surface);
            border-top: 1px solid var(--border);
            display: grid;
            grid-template-columns: 280px 1fr;
            box-shadow: 0 -1px 3px rgba(0, 0, 0, 0.05);
        }

        .controls-area {
            padding: 16px;
            border-right: 1px solid var(--border);
        }

        .chart-area {
            padding: 16px;
            position: relative;
        }

        /* CHARTS */
        .chart-container {
            height: 100%;
            position: relative;
            min-height: 200px;
        }

        /* REAL-TIME TERMINAL */
        .live-terminal {
            height: 120px;
            overflow-y: auto;
            background: rgba(241, 245, 249, 0.5);
            border: 1px solid var(--border);
            border-radius: 0 0 4px 4px;
            padding: 8px;
            font-size: 10px;
            line-height: 1.4;
            margin: 0 16px 8px;
        }
        
        .live-terminal::-webkit-scrollbar {
            width: 2px;
        }
        
        .live-terminal::-webkit-scrollbar-track {
            background: transparent;
        }
        
        .live-terminal::-webkit-scrollbar-thumb {
            background: rgba(100, 116, 139, 0.3);
            border-radius: 1px;
        }
        
        .live-terminal::-webkit-scrollbar-thumb:hover {
            background: rgba(100, 116, 139, 0.5);
        }
        
        .terminal-header {
            background: var(--surface-light);
            color: var(--text-dim);
            font-weight: 600;
            font-size: 9px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            padding: 6px 10px;
            margin: 0 16px 0;
            border: 1px solid var(--border);
            border-bottom: none;
            border-radius: 4px 4px 0 0;
        }

        .terminal-line {
            margin-bottom: 2px;
            font-family: 'JetBrains Mono', monospace;
        }

        .term-time {
            color: var(--text-dim);
            margin-right: 8px;
        }

        /* BUTTONS */
        .btn {
            background: var(--surface-light);
            border: 1px solid var(--border);
            color: var(--text-main);
            padding: 6px 12px;
            border-radius: 4px;
            font-size: 10px;
            cursor: pointer;
            transition: all 0.2s;
            font-family: 'JetBrains Mono', monospace;
        }

        .btn:hover {
            background: var(--surface);
            border-color: var(--terminal-info);
        }

        .btn-primary {
            background: var(--terminal-info);
            color: white;
            border-color: var(--terminal-info);
        }

        .btn-primary:hover {
            background: #475569;
        }

        /* PROGRESS BARS */
        .progress {
            height: 4px;
            background: rgba(0, 0, 0, 0.05);
            border-radius: 2px;
            overflow: hidden;
            margin: 4px 0;
            position: relative;
        }

        .progress-bar {
            height: 100%;
            transition: width 0.3s ease;
            animation: progressAnimation 4s ease-in-out infinite;
        }

        @keyframes progressAnimation {
            0%, 100% { width: var(--progress-width); }
            50% { width: calc(var(--progress-width) + 2%); }
        }

        /* TERMINAL VIEW FOR TABS */
        .terminal-view {
            background: var(--surface-light);
            border: 1px solid var(--border);
            border-radius: 4px;
            padding: 12px;
            height: calc(100% - 40px);
            overflow-y: auto;
            font-family: 'JetBrains Mono', monospace;
            font-size: 10px;
            line-height: 1.4;
        }

        .terminal-line {
            margin-bottom: 2px;
            white-space: pre-wrap;
            word-break: break-all;
        }

        .terminal-prefix {
            color: var(--terminal-ok);
        }

        .terminal-command {
            color: var(--text-bright);
        }

        .terminal-output {
            color: var(--text-dim);
            margin-left: 20px;
        }

        .terminal-output.highlight {
            color: var(--text-bright);
            background: rgba(16, 185, 129, 0.1);
            padding: 2px 4px;
            border-radius: 2px;
        }

        /* SCROLLBAR */
        ::-webkit-scrollbar {
            width: 4px;
            height: 4px;
        }

        ::-webkit-scrollbar-track {
            background: transparent;
        }

        ::-webkit-scrollbar-thumb {
            background: rgba(100, 116, 139, 0.3);
            border-radius: 2px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: rgba(100, 116, 139, 0.5);
        }

        /* UTILITY CLASSES */
        .text-success { color: var(--terminal-ok); }
        .text-warning { color: var(--terminal-warning); }
        .text-error { color: var(--terminal-error); }
        .text-info { color: var(--terminal-info); }
        .text-muted { color: var(--text-dim); }

        .font-bold { font-weight: 600; }
        .uppercase { text-transform: uppercase; }
        .monospace { font-family: 'JetBrains Mono', monospace; }

        .flex { display: flex; }
        .items-center { align-items: center; }
        .justify-between { justify-content: space-between; }
        .gap-2 { gap: 8px; }
        .gap-4 { gap: 16px; }
        .hidden { display: none; }

        .w-full { width: 100%; }
        .mb-2 { margin-bottom: 8px; }
        .mb-4 { margin-bottom: 16px; }
        .mt-3 { margin-top: 12px; }
        .p-2 { padding: 8px; }
        .p-3 { padding: 12px; }
        .absolute { position: absolute; }
        .top-2 { top: 8px; }
        .left-4 { left: 16px; }

        /* ANIMATIONS */
        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }

        .blink {
            animation: blink 1s infinite;
        }
        
        /* ===== MOBILE ===== */
        @media (max-width: 768px) {
            
            body {
                overflow-y: auto;
                height: auto;
            }
            
            /* –ö–ù–û–ü–ö–ê –ê–ì–ï–ù–¢–ê - –°–õ–ï–í–ê, –ü–û–î –í–ö–õ–ê–î–ö–ê–ú–ò */
            body::after {
                content: "üë§ –ê–ì–ï–ù–¢";
                position: fixed;
                left: 8px;
                top: 90px;
                padding: 8px 12px;
                background: var(--terminal-ok);
                color: white;
                border-radius: 6px;
                font-size: 11px;
                font-weight: 700;
                z-index: 999;
                cursor: pointer;
                box-shadow: 0 4px 12px rgba(16, 185, 129, 0.4);
                border: 2px solid white;
            }
            
            /* GRID –ë–ï–ó –ê–ì–ï–ù–¢–ê */
            .app-grid {
                display: block;
                height: auto;
            }
            
            .top-bar {
                position: relative;
            }
            
            .main-area {
                position: relative;
                height: auto;
                overflow: visible;
            }
            
            /* –¢–ê–ë–õ–ò–¶–ê –ü–õ–ê–¢–ï–ñ–ï–ô - 12 –°–¢–†–û–ö */
            .tabs-container {
                max-height: 240px;
                overflow-y: auto;
            }
            
            /* –°–∫—Ä–æ–ª–ª–±–∞—Ä –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã –Ω–∞ –º–æ–±–∏–ª–∫–µ */
            .tabs-container::-webkit-scrollbar {
                width: 2px;
            }
            
            .tabs-container::-webkit-scrollbar-track {
                background: transparent;
            }
            
            .tabs-container::-webkit-scrollbar-thumb {
                background: rgba(100, 116, 139, 0.3);
                border-radius: 1px;
            }
            
            .tabs-container::-webkit-scrollbar-thumb:hover {
                background: rgba(100, 116, 139, 0.5);
            }
            
            /* –¢–ï–†–ú–ò–ù–ê–õ - 12 –°–¢–†–û–ö */
            .live-terminal {
                height: 160px;
                font-size: 9px;
                margin: 4px;
                line-height: 1.5;
                overflow-y: auto;
            }
            
            .live-terminal::-webkit-scrollbar {
                width: 2px;
            }
            
            .live-terminal::-webkit-scrollbar-thumb {
                background: rgba(100, 116, 139, 0.3);
                border-radius: 1px;
            }
            
            .live-terminal::-webkit-scrollbar-thumb:hover {
                background: rgba(100, 116, 139, 0.5);
            }
            
            .terminal-header {
                font-size: 8px;
                padding: 4px;
            }
            
            /* –ê–ì–ï–ù–¢ –í–°–ü–õ–´–í–ê–Æ–©–ò–ô */
            .agent-sidebar {
                display: block;
                position: fixed;
                left: -100%;
                top: 0;
                width: 80%;
                max-width: 300px;
                height: 100vh;
                z-index: 1000;
                transition: left 0.3s ease;
                box-shadow: 2px 0 20px rgba(0,0,0,0.3);
            }
            
            .agent-sidebar.mobile-open {
                left: 0;
            }
            
            /* –ó–∞—Ç–µ–º–Ω–µ–Ω–∏–µ —Ñ–æ–Ω–∞ */
            body::before {
                content: "";
                display: none;
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.5);
                z-index: 999;
            }
            
            body.agent-open::before {
                display: block;
            }
            
            /* –•–ï–î–ï–† */
            .top-bar {
                font-size: 7px;
                padding: 4px;
                flex-wrap: wrap;
            }
            
            .top-bar input {
                width: 30px !important;
                font-size: 8px;
            }
            
            /* –í–ö–õ–ê–î–ö–ò */
            .table-tab {
                font-size: 9px;
                padding: 6px 8px;
            }
            
            /* –¢–ê–ë–õ–ò–¶–ê */
            .tab-content {
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
            }
            
            .dense-table {
                font-size: 7px;
                min-width: 100%;
                white-space: nowrap;
            }
            
            .dense-table th,
            .dense-table td {
                padding: 2px;
            }
            
            /* –ü–†–Ø–ß–£ –ö–û–õ–û–ù–ö–ò —Ç–æ–ª—å–∫–æ –≤ –û–ß–ï–†–ï–î–¨_–ü–õ–ê–¢–ï–ñ–ï–ô */
            #payment-content .dense-table th:nth-child(1),
            #payment-content .dense-table td:nth-child(1),
            #payment-content .dense-table th:nth-child(8),
            #payment-content .dense-table td:nth-child(8) {
                display: none;
            }
            
            /* –¢–ï–†–ú–ò–ù–ê–õ */
            .terminal-header {
                font-size: 7px;
                padding: 4px;
                margin: 0 4px;
            }
            
            /* –ù–ò–ñ–ù–Ø–Ø –ü–ê–ù–ï–õ–¨ - –ö–û–ú–ü–ê–ö–¢–ù–û */
            .analysis-panel {
                font-size: 7px;
                padding: 4px;
                grid-template-columns: 1fr;
            }
            
            .controls-area {
                padding: 4px;
            }
            
            .controls-area > div {
                margin-bottom: 4px;
            }
            
            .controls-area input {
                width: 35px !important;
                font-size: 7px;
                padding: 2px;
            }
            
            .controls-area label,
            .controls-area .text-muted {
                font-size: 7px;
            }
            
            /* –ì–†–ê–§–ò–ö –ö–û–ú–ü–ê–ö–¢–ù–´–ô */
            .chart-container {
                height: 60px;
            }
            
            #forecast-result {
                font-size: 7px;
                padding: 4px;
                line-height: 1.3;
            }
            
            /* –ó–∞–≥–æ–ª–æ–≤–∫–∏ */
            .analysis-panel .uppercase {
                font-size: 8px;
                margin-bottom: 4px;
            }
        }
    </style>
    
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div class="app-grid">
        
        <!-- TOP BAR -->
        <header class="top-bar">
            <div class="flex items-center gap-4">
                <div class="flex items-center">
                    <div class="live-indicator"></div>
                    <span class="terminal-prompt">‚ÇΩ</span>
                    <span class="text-bright">–°–†–û_–¢–ï–†–ú_v3</span>
                </div>
                
                <div class="flex items-center gap-4 text-muted">
                    <div class="flex items-center gap-2">
                        <span>–ö–õ–Æ–ß_–°–¢–ê–í–ö–ê:</span>
                        <input type="number" value="16.0" class="term-input" id="key-rate" onchange="recalculateAll()" style="background: rgba(255,255,255,0.1); color: white; border-color: #334155; width: 60px;">
                        <span>%</span>
                    </div>
                    
                    <div class="flex items-center gap-2">
                        <span>–£–î–û–†_–ú–ê–¢:</span>
                        <input type="number" value="5.2" class="term-input" id="mat-inflation" onchange="recalculateAll()" style="background: rgba(255,255,255,0.1); color: white; border-color: #334155; width: 60px;">
                        <span>%</span>
                    </div>
                </div>
            </div>
            
            <div class="flex items-center gap-6 text-muted">
                <div>
                    <span class="text-muted" style="font-size: 9px;">–°–ß–Å–¢:</span>
                    <span class="text-success font-bold" style="font-size: 11px;">58.3 M ‚ÇΩ</span>
                </div>
                <div>
                    <span class="text-muted" style="font-size: 9px;">–ü–õ–ê–¢–ï–ñ–ò:</span>
                    <span class="text-error font-bold" style="font-size: 11px;">22.1 M ‚ÇΩ</span>
                </div>
                <div>
                    <span class="text-muted" style="font-size: 9px;">–†–ê–ó–ù–ò–¶–ê:</span>
                    <span class="text-success font-bold" style="font-size: 11px;">+36.2 M ‚ÇΩ</span>
                </div>
                <div>
                    <span class="text-muted" style="font-size: 9px;">RUNWAY:</span>
                    <span class="text-warning font-bold" style="font-size: 11px;">4.2</span>
                    <span class="text-muted" style="font-size: 9px;">–º–µ—Å</span>
                </div>
                <div>
                    <span class="text-muted" style="font-size: 9px;">–ö–†–ï–î–ò–¢:</span>
                    <span class="text-info" style="font-size: 11px;">45 M ‚ÇΩ</span>
                </div>
                <div>
                    <span class="text-muted">–°–ò–°–¢–ï–ú–ê:</span>
                    <span class="text-success blink">–ö–û–ù–¢–†–û–õ–¨ ‚óè</span>
                </div>
            </div>
        </header>

        <!-- AGENT SIDEBAR -->
        <div class="agent-sidebar">
            <div class="agent-header">
                <div class="agent-avatar">A</div>
                <span>–ê–ì–ï–ù–¢</span>
            </div>
            
            <div class="agent-messages" id="agent-messages">
                <!-- Agent messages will be populated -->
            </div>
            
            <div class="agent-actions">
                <button class="agent-action-btn" onclick="optimizePayments()" id="optimize-btn">–û–ü–¢–ò–ú–ò–ó–ò–†–û–í–ê–¢–¨_–ü–õ–ê–¢–ï–ñ–ò</button>
                <button class="agent-action-btn" onclick="predictCashGap()" id="predict-btn">–ê–ù–ê–õ–ò–ó_–ö–ê–°–°–û–í–û–ì–û_–†–ê–ó–†–´–í–ê</button>
                <button class="agent-action-btn" onclick="suggestCollection()" id="collect-btn">–ò–ù–ö–ê–°–°–ê–¶–ò–Ø_–î–ï–ë–ò–¢–û–†–ö–ò</button>
                <button class="agent-action-btn" onclick="generateReport()" id="report-btn">–°–§–û–†–ú–ò–†–û–í–ê–¢–¨_–û–¢–ß–ï–¢</button>
            </div>
        </div>

        <!-- MAIN AREA -->
        <div class="main-area">
            <div class="table-tabs">
                <div class="table-tab active" onclick="switchTab('payment')">–û–ß–ï–†–ï–î–¨_–ü–õ–ê–¢–ï–ñ–ï–ô</div>
                <div class="table-tab" onclick="switchTab('projects')">–ü–†–û–ï–ö–¢–´</div>
                <div class="table-tab" onclick="switchTab('ks')">–ö–°-2/–ö–°-3</div>
                <div class="table-tab" onclick="switchTab('dashboard')">–ú–û–ù–ò–¢–û–†–ò–ù–ì</div>
            </div>
            
            <div class="tabs-container">
            <!-- Payment Queue Tab -->
            <div id="payment-content" class="tab-content active">
                <table class="dense-table" id="payment-table">
                    <thead>
                        <tr>
                            <th>‚úì</th>
                            <th>–ü–†–û–ï–ö–¢ / –û–ë–™–ï–ö–¢</th>
                            <th>–ö–û–ù–¢–†–ê–ì–ï–ù–¢ / –ù–ê–ó–ù–ê–ß–ï–ù–ò–ï</th>
                            <th>–ë–Æ–î–ñ–ï–¢</th>
                            <th>–§–ê–ö–¢</th>
                            <th style="color: var(--terminal-ok)">–ü–†–ò–•–û–î</th>
                            <th style="color: var(--terminal-error)">–í–´–ü–õ–ê–¢–´</th>
                            <th style="border-left: 2px solid var(--terminal-info)">–ó–ê–ü–†–û–°</th>
                            <th>–°–†–û–ö</th>
                            <th>–°–¢–ê–¢–£–°</th>
                            <th>–†–ò–°–ö</th>
                        </tr>
                    </thead>
                    <tbody id="table-body">
                        <!-- Table rows will be populated -->
                    </tbody>
                </table>
            </div>
            
            <!-- Projects Tab -->
            <div id="projects-content" class="tab-content">
                <table class="dense-table">
                    <thead>
                        <tr>
                            <th style="text-align: left;">–ü–†–û–ï–ö–¢</th>
                            <th>–ë–Æ–î–ñ–ï–¢</th>
                            <th>–í–´–ü–û–õ–ù–ï–ù–û</th>
                            <th>%</th>
                            <th>–†–ê–°–•–û–î</th>
                            <th>–û–°–¢–ê–¢–û–ö</th>
                            <th>–ú–ê–†–ñ–ê_%</th>
                            <th>–°–¢–ê–¢–£–°</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td style="text-align: left;"><strong>–ñ–ö_–°–ï–í–ï–†–ù–´–ô</strong></td>
                            <td style="text-align: right;">245.8 M</td>
                            <td style="text-align: right;"><span class="dynamic-number">187.2</span> M</td>
                            <td style="text-align: right;"><span class="dynamic-number">76</span>%</td>
                            <td style="text-align: right;"><span class="dynamic-number">178.4</span> M</td>
                            <td style="text-align: right;"><span class="dynamic-number">67.4</span> M</td>
                            <td style="text-align: right; color: var(--terminal-ok);"><span class="dynamic-number">8.9</span>%</td>
                            <td><span class="badge badge-success">–í_–ü–õ–ê–ù–ï</span></td>
                        </tr>
                        <tr>
                            <td style="text-align: left;"><strong>–¢–¶_–ü–õ–ê–ó–ê</strong></td>
                            <td style="text-align: right;">128.5 M</td>
                            <td style="text-align: right;"><span class="dynamic-number">89.3</span> M</td>
                            <td style="text-align: right;"><span class="dynamic-number">69</span>%</td>
                            <td style="text-align: right;"><span class="dynamic-number">87.1</span> M</td>
                            <td style="text-align: right;"><span class="dynamic-number">41.4</span> M</td>
                            <td style="text-align: right; color: var(--terminal-ok);"><span class="dynamic-number">2.2</span>%</td>
                            <td><span class="badge badge-warning">–ó–ê–î–ï–†–ñ–ö–ê_3–î</span></td>
                        </tr>
                        <tr>
                            <td style="text-align: left;"><strong>–ì–û–°_–ö–û–ù–¢–†–ê–ö–¢_245</strong></td>
                            <td style="text-align: right;">89.0 M</td>
                            <td style="text-align: right;"><span class="dynamic-number">45.8</span> M</td>
                            <td style="text-align: right;"><span class="dynamic-number">51</span>%</td>
                            <td style="text-align: right;"><span class="dynamic-number">42.3</span> M</td>
                            <td style="text-align: right;"><span class="dynamic-number">46.7</span> M</td>
                            <td style="text-align: right; color: var(--terminal-ok);"><span class="dynamic-number">3.5</span>%</td>
                            <td><span class="badge badge-success">–í_–ü–õ–ê–ù–ï</span></td>
                        </tr>
                        <tr>
                            <td style="text-align: left;"><strong>–†–ï–ö–û–ù–°–¢–†–£–ö–¶–ò–Ø_–ú–û–°–¢–ê</strong></td>
                            <td style="text-align: right;">156.2 M</td>
                            <td style="text-align: right;"><span class="dynamic-number">98.7</span> M</td>
                            <td style="text-align: right;"><span class="dynamic-number">63</span>%</td>
                            <td style="text-align: right;"><span class="dynamic-number">95.8</span> M</td>
                            <td style="text-align: right;"><span class="dynamic-number">60.4</span> M</td>
                            <td style="text-align: right; color: var(--terminal-ok);"><span class="dynamic-number">2.9</span>%</td>
                            <td><span class="badge badge-success">–í_–ü–õ–ê–ù–ï</span></td>
                        </tr>
                        <tr>
                            <td style="text-align: left;"><strong>–û–§–ò–°_–ú–û–°–ö–í–ê_–°–ò–¢–ò</strong></td>
                            <td style="text-align: right;">78.3 M</td>
                            <td style="text-align: right;"><span class="dynamic-number">12.5</span> M</td>
                            <td style="text-align: right;"><span class="dynamic-number">16</span>%</td>
                            <td style="text-align: right;"><span class="dynamic-number">11.8</span> M</td>
                            <td style="text-align: right;"><span class="dynamic-number">66.5</span> M</td>
                            <td style="text-align: right; color: var(--terminal-ok);"><span class="dynamic-number">0.7</span>%</td>
                            <td><span class="badge badge-info">–°–¢–ê–†–¢</span></td>
                        </tr>
                        <tr>
                            <td style="text-align: left;"><strong>–°–ö–õ–ê–î–°–ö–û–ô_–ö–û–ú–ü–õ–ï–ö–°</strong></td>
                            <td style="text-align: right;">195.0 M</td>
                            <td style="text-align: right;"><span class="dynamic-number">156.0</span> M</td>
                            <td style="text-align: right;"><span class="dynamic-number">80</span>%</td>
                            <td style="text-align: right;"><span class="dynamic-number">148.2</span> M</td>
                            <td style="text-align: right;"><span class="dynamic-number">46.8</span> M</td>
                            <td style="text-align: right; color: var(--terminal-ok);"><span class="dynamic-number">7.8</span>%</td>
                            <td><span class="badge badge-success">–í_–ü–õ–ê–ù–ï</span></td>
                        </tr>
                    </tbody>
                </table>
            </div>
            
            <!-- KS-2/KS-3 Tab -->
            <div id="ks-content" class="tab-content">
                <table class="dense-table">
                    <thead>
                        <tr>
                            <th style="text-align: left;">–î–û–ö–£–ú–ï–ù–¢</th>
                            <th style="text-align: left;">–ü–†–û–ï–ö–¢</th>
                            <th>–°–£–ú–ú–ê</th>
                            <th>–î–ê–¢–ê</th>
                            <th>–ü–†–û–°–†–û–ß–ö–ê</th>
                            <th>–°–¢–ê–¢–£–°</th>
                            <th>–î–ï–ô–°–¢–í–ò–ï</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td style="text-align: left;"><strong>–ö–°-2-045/24</strong></td>
                            <td style="text-align: left;">–ñ–ö_–°–ï–í–ï–†–ù–´–ô</td>
                            <td style="text-align: right;"><span class="dynamic-number">8.5</span> M</td>
                            <td style="text-align: right;">25.11.24</td>
                            <td style="text-align: right; color: var(--terminal-warning);">12 –¥–Ω</td>
                            <td><span class="badge badge-warning">–û–ñ–ò–î–ê–ï–¢</span></td>
                            <td><button class="btn btn-sm">–ó–≤–æ–Ω–∏—Ç—å</button></td>
                        </tr>
                        <tr>
                            <td style="text-align: left;"><strong>–ö–°-3-128/24</strong></td>
                            <td style="text-align: left;">–¢–¶_–ü–õ–ê–ó–ê</td>
                            <td style="text-align: right;"><span class="dynamic-number">12.2</span> M</td>
                            <td style="text-align: right;">25.11.24</td>
                            <td style="text-align: right; color: var(--terminal-ok);">0 –¥–Ω</td>
                            <td><span class="badge badge-success">–ü–û–î–ü–ò–°–ê–ù</span></td>
                            <td><button class="btn btn-sm">–ü–ª–∞—Ç—ë–∂</button></td>
                        </tr>
                        <tr>
                            <td style="text-align: left;"><strong>–ö–°-2-089/24</strong></td>
                            <td style="text-align: left;">–ì–û–°_245</td>
                            <td style="text-align: right;"><span class="dynamic-number">15.8</span> M</td>
                            <td style="text-align: right;">10.11.24</td>
                            <td style="text-align: right; color: var(--terminal-error);">22 –¥–Ω</td>
                            <td><span class="badge badge-error">–ü–†–û–°–†–û–ß–ï–ù</span></td>
                            <td><button class="btn btn-sm">–ü—Ä–µ—Ç–µ–Ω–∑–∏—è</button></td>
                        </tr>
                        <tr>
                            <td style="text-align: left;"><strong>–ö–°-3-067/24</strong></td>
                            <td style="text-align: left;">–ú–û–°–¢</td>
                            <td style="text-align: right;"><span class="dynamic-number">22.5</span> M</td>
                            <td style="text-align: right;">18.11.24</td>
                            <td style="text-align: right; color: var(--terminal-warning);">14 –¥–Ω</td>
                            <td><span class="badge badge-warning">–ò–°–ü–†–ê–í–õ–ï–ù–ò–ï</span></td>
                            <td><button class="btn btn-sm">–ö–æ–Ω—Ç—Ä–æ–ª—å</button></td>
                        </tr>
                        <tr>
                            <td style="text-align: left;"><strong>–ö–°-2-112/24</strong></td>
                            <td style="text-align: left;">–ñ–ö_–°–ï–í–ï–†–ù–´–ô</td>
                            <td style="text-align: right;"><span class="dynamic-number">5.3</span> M</td>
                            <td style="text-align: right;">28.11.24</td>
                            <td style="text-align: right; color: var(--terminal-ok);">4 –¥–Ω</td>
                            <td><span class="badge badge-info">–û–¢–ü–†–ê–í–õ–ï–ù</span></td>
                            <td><button class="btn btn-sm">–û–∂–∏–¥–∞—Ç—å</button></td>
                        </tr>
                        <tr>
                            <td style="text-align: left;"><strong>–ö–°-2-134/24</strong></td>
                            <td style="text-align: left;">–°–ö–õ–ê–î</td>
                            <td style="text-align: right;"><span class="dynamic-number">18.9</span> M</td>
                            <td style="text-align: right;">01.12.24</td>
                            <td style="text-align: right; color: var(--terminal-ok);">1 –¥–Ω</td>
                            <td><span class="badge badge-info">–ù–û–í–´–ô</span></td>
                            <td><button class="btn btn-sm">–ü—Ä–æ–≤–µ—Ä–∫–∞</button></td>
                        </tr>
                    </tbody>
                </table>
            </div>
            
            <!-- Monitoring Tab -->
            <div id="dashboard-content" class="tab-content">
                <table class="dense-table">
                    <thead>
                        <tr>
                            <th style="text-align: left;">–ú–ï–¢–†–ò–ö–ê</th>
                            <th>–¢–ï–ö–£–©–ï–ï</th>
                            <th>–ü–†–û–ì–ù–û–ó</th>
                            <th>–ò–ó–ú–ï–ù–ï–ù–ò–ï</th>
                            <th>–°–¢–ê–¢–£–°</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td style="text-align: left;"><strong>–ö–ê–°–°–ê</strong></td>
                            <td style="text-align: right;"><span class="dynamic-number">58.3</span> M ‚ÇΩ</td>
                            <td style="text-align: right;"><span class="dynamic-number">62.1</span> M ‚ÇΩ</td>
                            <td style="text-align: right; color: var(--terminal-ok);">+6.5%</td>
                            <td><span class="badge badge-success">OK</span></td>
                        </tr>
                        <tr>
                            <td style="text-align: left;"><strong>–î–ï–ë–ò–¢–û–†–ö–ê</strong></td>
                            <td style="text-align: right;"><span class="dynamic-number">89.0</span> M ‚ÇΩ</td>
                            <td style="text-align: right;"><span class="dynamic-number">75.2</span> M ‚ÇΩ</td>
                            <td style="text-align: right; color: var(--terminal-ok);">-15.5%</td>
                            <td><span class="badge badge-success">–°–ù–ò–ñ–ê–ï–¢–°–Ø</span></td>
                        </tr>
                        <tr>
                            <td style="text-align: left;"><strong>–ö–†–ï–î–ò–¢–û–†–ö–ê</strong></td>
                            <td style="text-align: right;"><span class="dynamic-number">38.7</span> M ‚ÇΩ</td>
                            <td style="text-align: right;"><span class="dynamic-number">42.3</span> M ‚ÇΩ</td>
                            <td style="text-align: right; color: var(--terminal-warning);">+9.3%</td>
                            <td><span class="badge badge-warning">–†–û–°–¢</span></td>
                        </tr>
                        <tr>
                            <td style="text-align: left;"><strong>–û–ë–û–†–û–¢_–ú–ï–°–Ø–¶</strong></td>
                            <td style="text-align: right;"><span class="dynamic-number">156.8</span> M ‚ÇΩ</td>
                            <td style="text-align: right;"><span class="dynamic-number">162.3</span> M ‚ÇΩ</td>
                            <td style="text-align: right; color: var(--terminal-ok);">+3.5%</td>
                            <td><span class="badge badge-success">–í_–ü–õ–ê–ù–ï</span></td>
                        </tr>
                        <tr>
                            <td style="text-align: left;"><strong>–ú–ê–†–ñ–ê</strong></td>
                            <td style="text-align: right;"><span class="dynamic-number">18.2</span>%</td>
                            <td style="text-align: right;"><span class="dynamic-number">19.5</span>%</td>
                            <td style="text-align: right; color: var(--terminal-ok);">+1.3%</td>
                            <td><span class="badge badge-success">–†–û–°–¢</span></td>
                        </tr>
                        <tr>
                            <td style="text-align: left;"><strong>RUNWAY</strong></td>
                            <td style="text-align: right;"><span class="dynamic-number">4.2</span> –º–µ—Å</td>
                            <td style="text-align: right;"><span class="dynamic-number">4.8</span> –º–µ—Å</td>
                            <td style="text-align: right; color: var(--terminal-ok);">+14.3%</td>
                            <td><span class="badge badge-success">–£–õ–£–ß–®–ï–ù–ò–ï</span></td>
                        </tr>
                    </tbody>
                </table>
            </div>
            </div>
            
            <!-- Real-time Terminal -->
            <div class="terminal-wrapper">
                <div class="terminal-header">–û–ü–ï–†–ê–¶–ò–û–ù–ù–´–ô_–¢–ï–†–ú–ò–ù–ê–õ | LIVE</div>
                <div class="live-terminal" id="live-terminal">
                    <!-- Terminal output -->
                </div>
            </div>
        </div>

        <!-- ANALYSIS PANEL -->
        <div class="analysis-panel">
            <div class="controls-area">
                <div class="text-muted uppercase font-bold mb-4">–°–¶–ï–ù–ê–†–ù–´–ô_–ê–ù–ê–õ–ò–ó</div>
                
                <div class="bg-surface-light p-3 border border-border rounded mb-4">
                    <div class="text-muted uppercase font-bold mb-2" style="font-size: 9px;">–ß–¢–û_–ï–°–õ–ò:</div>
                    
                    <div class="mb-2">
                        <div class="flex justify-between items-center">
                            <span class="text-muted" style="font-size: 9px;">–ó–∞–¥–µ—Ä–∂–∫–∞_–ø–ª–∞—Ç–µ–∂–∞_(–¥–Ω):</span>
                            <input type="number" value="0" min="0" max="90" id="sc-delay" onchange="runScenario()" style="width: 50px; font-size: 9px; padding: 2px; text-align: right;" class="term-input">
                        </div>
                    </div>
                    
                    <div class="mb-2">
                        <div class="flex justify-between items-center">
                            <span class="text-muted" style="font-size: 9px;">–î–æ–ø_—Ä–∞—Å—Ö–æ–¥—ã_(%):</span>
                            <input type="number" value="0" min="0" max="50" step="5" id="sc-costs" onchange="runScenario()" style="width: 50px; font-size: 9px; padding: 2px; text-align: right;" class="term-input">
                        </div>
                    </div>
                    
                    <div class="mb-2">
                        <div class="flex justify-between items-center">
                            <span class="text-muted" style="font-size: 9px;">–ü–æ—Ç–µ—Ä—è_–¥–æ—Ö–æ–¥–∞_(%):</span>
                            <input type="number" value="0" min="0" max="100" step="10" id="sc-income" onchange="runScenario()" style="width: 50px; font-size: 9px; padding: 2px; text-align: right;" class="term-input">
                        </div>
                    </div>
                    
                    <div style="border-top: 1px solid var(--border); margin-top: 8px; padding-top: 8px;">
                        <div class="flex justify-between mb-2">
                            <span class="text-muted">–í—ã–±—Ä–∞–Ω–æ –∫ –æ–ø–ª–∞—Ç–µ:</span>
                            <span class="text-info font-bold dynamic-number" id="total-selected">4.7 M</span>
                        </div>
                        <div class="flex justify-between mb-2">
                            <span class="text-muted">–¢–µ–∫—É—â–∏–π –æ—Å—Ç–∞—Ç–æ–∫:</span>
                            <span class="text-success font-bold dynamic-number" id="current-cash">12.6 M</span>
                        </div>
                        <div class="progress">
                            <div class="progress-bar" id="cash-progress" style="background: var(--terminal-ok);"></div>
                        </div>
                        <div class="flex justify-between items-center mt-3">
                            <span class="font-bold">–ü–†–û–ì–ù–û–ó_(–°–¶–ï–ù–ê–†–ò–ô):</span>
                            <span class="text-2xl font-bold dynamic-number" id="forecast-cash">7.8 M</span>
                        </div>
                    </div>
                </div>
                
                <button class="btn btn-primary w-full mb-2" onclick="commitPayments()">
                    ‚ÇΩ –£–¢–í–ï–†–î–ò–¢–¨_–†–ï–ï–°–¢–†
                </button>
                
                <div id="alert-box" class="hidden p-2 text-center text-xs font-bold rounded border" style="background: rgba(239, 68, 68, 0.1); border-color: var(--terminal-error); color: var(--terminal-error);">
                    ‚ö† –û–ë–ù–ê–†–£–ñ–ï–ù_–ö–ê–°–°–û–í–´–ô_–†–ê–ó–†–´–í
                </div>
            </div>
            
            <div class="chart-area">
                <div class="text-muted uppercase font-bold absolute top-2 left-4">–õ–ò–ö–í–ò–î–ù–û–°–¢–¨_(–°–¶–ï–ù–ê–†–ò–ô)</div>
                <div class="chart-container">
                    <canvas id="liquidityChart"></canvas>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Core Data
        const projectsData = [
            { 
                id: 1, 
                proj: "–ñ–ö '–°–ï–í–ï–†–ù–´–ô'", 
                agent: "–û–û–û '–ë–µ—Ç–æ–Ω-–°–µ—Ä–≤–∏—Å'", 
                desc: "–ë–µ—Ç–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —ç—Ç.4",
                budget: 15.0, 
                actual: 12.5, 
                incoming: 2.0, 
                outgoing: 1.0, 
                request: 8.5, 
                due: "–°–ï–ì–û–î–ù–Ø", 
                type: "sub",
                status: "pending",
                risk: "medium",
                b2b_gap: false
            },
            { 
                id: 2, 
                proj: "–ñ–ö '–°–ï–í–ï–†–ù–´–ô'", 
                agent: "–û–û–û '–ú–µ—Ç–∞–ª–ª-–¢—Ä–µ–π–¥'", 
                desc: "–ê—Ä–º–∞—Ç—É—Ä–∞ –ê500–°",
                budget: 40.0, 
                actual: 38.0, 
                incoming: 35.0, 
                outgoing: 25.0, 
                request: 4.5, 
                due: "–ó–ê–í–¢–†–ê", 
                type: "mat",
                status: "approved",
                risk: "low",
                b2b_gap: false
            },
            { 
                id: 3, 
                proj: "–§–ò–° / –ê–£–ü", 
                agent: "–í–¢–ë (–ü–ê–û)", 
                desc: "–ü—Ä–æ—Ü–µ–Ω—Ç—ã –ø–æ –∫—Ä–µ–¥–∏—Ç—É",
                budget: 12.0, 
                actual: 12.0, 
                incoming: 0.0, 
                outgoing: 0.0, 
                request: 1.2, 
                due: "–°–µ–≥–æ–¥–Ω—è", 
                type: "bank",
                status: "critical",
                risk: "high",
                b2b_gap: false
            },
            { 
                id: 4, 
                proj: "–¢–¶ '–ü–õ–ê–ó–ê'", 
                agent: "–ò–ü –ò–≤–∞–Ω–æ–≤ (–í–µ–Ω—Ç)", 
                desc: "–ú–æ–Ω—Ç–∞–∂ –≤–µ–Ω—Ç–∏–ª—è—Ü–∏–∏",
                budget: 5.0, 
                actual: 2.0, 
                incoming: 0.0, 
                outgoing: 0.0, 
                request: 1.2, 
                due: "12.12", 
                type: "sub",
                status: "pending",
                risk: "medium",
                b2b_gap: true
            },
            { 
                id: 5, 
                proj: "–ù–ê–õ–û–ì–ò", 
                agent: "–§–ù–° –†–û–°–°–ò–ò", 
                desc: "–ù–î–° 3 –∫–≤.",
                budget: 18.0, 
                actual: 18.0, 
                incoming: 0.0, 
                outgoing: 12.0, 
                request: 3.5, 
                due: "25.12", 
                type: "tax",
                status: "critical",
                risk: "high",
                b2b_gap: false
            },
            { 
                id: 6, 
                proj: "–ì–û–°_–ö–û–ù–¢–†–ê–ö–¢", 
                agent: "–û–û–û '–°—Ç—Ä–æ–π-–ú'", 
                desc: "–°—É–±–ø–æ–¥—Ä—è–¥ —Å—Ç–µ–Ω—ã",
                budget: 55.0, 
                actual: 10.0, 
                incoming: 5.0, 
                outgoing: 0.0, 
                request: 8.0, 
                due: "30.12", 
                type: "sub",
                status: "approved",
                risk: "low",
                b2b_gap: false
            },
            { 
                id: 7, 
                proj: "–°–ö–õ–ê–î_–õ–û–ì–ò–°–¢–ò–ö–ê", 
                agent: "–û–û–û '–ú–µ—Ç–∞–ª–ª–°—Ç—Ä–æ–π'", 
                desc: "–ú–µ—Ç–∞–ª–ª–æ–∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏",
                budget: 89.0, 
                actual: 67.0, 
                incoming: 55.0, 
                outgoing: 45.0, 
                request: 12.5, 
                due: "–ó–ê–í–¢–†–ê", 
                type: "mat",
                status: "pending",
                risk: "medium",
                b2b_gap: false
            },
            { 
                id: 8, 
                proj: "–ñ–ö_–Æ–ñ–ù–´–ô", 
                agent: "–û–û–û '–°—Ç—Ä–æ–π–¢–µ—Ö'", 
                desc: "–§–∞—Å–∞–¥–Ω—ã–µ —Ä–∞–±–æ—Ç—ã",
                budget: 125.0, 
                actual: 78.0, 
                incoming: 65.0, 
                outgoing: 50.0, 
                request: 18.5, 
                due: "15.12", 
                type: "sub",
                status: "approved",
                risk: "low",
                b2b_gap: false
            },
            { 
                id: 9, 
                proj: "–û–§–ò–°_–°–ò–¢–ò", 
                agent: "–ò–ü –ü–µ—Ç—Ä–æ–≤", 
                desc: "–≠–ª–µ–∫—Ç—Ä–æ–º–æ–Ω—Ç–∞–∂",
                budget: 34.0, 
                actual: 22.0, 
                incoming: 18.0, 
                outgoing: 15.0, 
                request: 6.8, 
                due: "–°–ï–ì–û–î–ù–Ø", 
                type: "sub",
                status: "pending",
                risk: "medium",
                b2b_gap: false
            },
            { 
                id: 10, 
                proj: "–¢–¶_–ê–¢–†–ò–£–ú", 
                agent: "–û–û–û '–ö–ª–∏–º–∞—Ç–¢–µ—Ö'", 
                desc: "–ö–æ–Ω–¥–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ",
                budget: 67.0, 
                actual: 45.0, 
                incoming: 38.0, 
                outgoing: 28.0, 
                request: 15.2, 
                due: "20.12", 
                type: "sub",
                status: "approved",
                risk: "low",
                b2b_gap: false
            },
            { 
                id: 11, 
                proj: "–ú–û–°–¢_–†–ï–ö–û–ù–°–¢–†–£–ö–¶–ò–Ø", 
                agent: "–û–û–û '–î–æ—Ä–°—Ç—Ä–æ–π'", 
                desc: "–ê—Å—Ñ–∞–ª—å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ",
                budget: 156.0, 
                actual: 98.0, 
                incoming: 85.0, 
                outgoing: 70.0, 
                request: 22.5, 
                due: "25.12", 
                type: "mat",
                status: "approved",
                risk: "low",
                b2b_gap: false
            },
            { 
                id: 12, 
                proj: "–®–ö–û–õ–ê_45", 
                agent: "–û–û–û '–û–∫–Ω–∞–ü–ª–∞—Å—Ç'", 
                desc: "–û—Å—Ç–µ–∫–ª–µ–Ω–∏–µ",
                budget: 28.0, 
                actual: 15.0, 
                incoming: 12.0, 
                outgoing: 8.0, 
                request: 5.5, 
                due: "–ó–ê–í–¢–†–ê", 
                type: "sub",
                status: "pending",
                risk: "medium",
                b2b_gap: false
            },
            { 
                id: 13, 
                proj: "–ü–ê–†–ö_–†–ê–ó–í–õ–ï–ß–ï–ù–ò–ô", 
                agent: "–û–û–û '–õ–∞–Ω–¥—à–∞—Ñ—Ç+'", 
                desc: "–ë–ª–∞–≥–æ—É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ",
                budget: 78.0, 
                actual: 45.0, 
                incoming: 38.0, 
                outgoing: 30.0, 
                request: 12.8, 
                due: "28.12", 
                type: "sub",
                status: "approved",
                risk: "low",
                b2b_gap: false
            },
            { 
                id: 14, 
                proj: "–ó–ê–í–û–î_–†–ï–ö–û–ù–°–¢–†–£–ö–¶–ò–Ø", 
                agent: "–û–û–û '–ü—Ä–æ–º–°—Ç—Ä–æ–π'", 
                desc: "–î–µ–º–æ–Ω—Ç–∞–∂ —Å—Ç–∞—Ä—ã—Ö —Ü–µ—Ö–æ–≤",
                budget: 234.0, 
                actual: 156.0, 
                incoming: 125.0, 
                outgoing: 98.0, 
                request: 38.5, 
                due: "–°–ï–ì–û–î–ù–Ø", 
                type: "sub",
                status: "critical",
                risk: "high",
                b2b_gap: false
            }
        ];

        // System State
        let selectedIds = new Set([3, 5]);
        let currentCash = 12.6;
        let creditLimit = 45.0;
        let chartInstance = null;
        let terminalLog = [];
        let agentMessages = [];

        // Agent Messages Queue
        const agentMessagePool = [
            { type: "system", text: "–ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞—Å—Å–æ–≤—ã—Ö —Ä–∞–∑—Ä—ã–≤–æ–≤ –∑–∞–≤–µ—Ä—à–µ–Ω–∞. –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–π –Ω–µ—Ç" },
            { type: "system", text: "–ü–æ–ª—É—á–µ–Ω—ã –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø–æ —Ü–µ–Ω–∞–º –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ –æ—Ç –ø–æ—Å—Ç–∞–≤—â–∏–∫–æ–≤" },
            { type: "info", text: "–ù–∞–ø—Ä–∞–≤–ª–µ–Ω—ã –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è 3 –∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç–∞–º –æ –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã—Ö –ø–ª–∞—Ç–µ–∂–∞—Ö" },
            { type: "info", text: "–í—Ö–æ–¥—è—â–∏–µ –ø–ª–∞—Ç–µ–∂–∏ –Ω–∞ 15% –≤—ã—à–µ —Å—Ä–µ–¥–Ω–µ–≥–æ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω—é—é –Ω–µ–¥–µ–ª—é" },
            { type: "critical", text: "–û–±–Ω–∞—Ä—É–∂–µ–Ω —Ä–∞–∑—Ä—ã–≤ –ë2–ë –≤ –ø—Ä–æ–µ–∫—Ç–µ –¢–¶ '–ü–õ–ê–ó–ê'. –¢—Ä–µ–±—É–µ—Ç—Å—è —Ä—É—á–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞" },
            { type: "system", text: "–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω –µ–∂–µ–¥–Ω–µ–≤–Ω—ã–π –æ—Ç—á–µ—Ç –ø–æ –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç–∏" },
            { type: "system", text: "–í—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–ª–∞—Ç–µ–∂–∏ –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω—ã –∫ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—é" },
            { type: "system", text: "–î–∞–Ω–Ω—ã–µ –±–∞–Ω–∫–æ–≤—Å–∫–∏—Ö –≤—ã–ø–∏—Å–æ–∫ –æ–±–Ω–æ–≤–ª–µ–Ω—ã" },
            { type: "info", text: "–ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–µ–±–∏—Ç–æ—Ä—Å–∫–æ–π –∑–∞–¥–æ–ª–∂–µ–Ω–Ω–æ—Å—Ç–∏: 5 –∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç–æ–≤ –≤ –ø—Ä–æ—Å—Ä–æ—á–∫–µ" },
            { type: "warning", text: "–ê–Ω–∞–ª–∏–∑ —Ä–∞—Å—Ö–æ–¥–æ–≤: –ø—Ä–µ–≤—ã—à–µ–Ω–∏–µ –±—é–¥–∂–µ—Ç–∞ –ø–æ –ø—Ä–æ–µ–∫—Ç—É –ñ–ö '–°–ï–í–ï–†–ù–´–ô' –Ω–∞ 8%" }
        ];

        // Terminal Messages
        const terminalMessages = [
            "[21:56:01] –°–ò–°–¢–ï–ú–ê: –°–†–û_–¢–ï–†–ú_v3 –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω",
            "[21:56:05] –ë–ê–ù–ö–ò: –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –í–¢–ë, –°–±–µ—Ä–±–∞–Ω–∫, –ê–ª—å—Ñ–∞-–ë–∞–Ω–∫ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ",
            "[21:56:15] –ú–û–î–ï–õ–¨: –ó–∞–≥—Ä—É–∂–µ–Ω–∞ —Å–∏—Å—Ç–µ–º–∞ –æ—Ü–µ–Ω–∫–∏ —Ä–∏—Å–∫–æ–≤",
            "[21:56:30] –ö–ê–°–°–ê: –ó–∞–ø—É—â–µ–Ω –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏",
            "[21:57:00] –û–ë–ù–û–í–õ–ï–ù–ò–ï: –ü–æ–ª—É—á–µ–Ω—ã –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ —Ü–µ–Ω—ã –Ω–∞ –º–∞—Ç–µ—Ä–∏–∞–ª—ã",
            "[21:57:15] –ü–†–û–í–ï–†–ö–ê: –û–±–Ω–∞—Ä—É–∂–µ–Ω–æ 2 –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –ø–ª–∞—Ç–µ–∂–∞"
        ];

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            initTerminal();
            renderTable();
            updateAnalysis();
            startLiveUpdates();
            initAgent();
            startDynamicUpdates();
            initMobileAgent();
        });
        
        // –ú–æ–±–∏–ª—å–Ω–æ–µ –º–µ–Ω—é –∞–≥–µ–Ω—Ç–∞
        function initMobileAgent() {
            if (window.innerWidth <= 768) {
                const agentBtn = document.querySelector('body::after');
                const agentSidebar = document.querySelector('.agent-sidebar');
                
                // –ö–ª–∏–∫ –Ω–∞ –∫–Ω–æ–ø–∫—É –∞–≥–µ–Ω—Ç–∞
                document.addEventListener('click', (e) => {
                    const rect = e.target.getBoundingClientRect();
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–ª–∏–∫ –≤ –æ–±–ª–∞—Å—Ç—å –∫–Ω–æ–ø–∫–∏ (left: 8px, top: 90px)
                    if (e.clientX < 100 && e.clientY > 80 && e.clientY < 130) {
                        agentSidebar.classList.add('mobile-open');
                        document.body.classList.add('agent-open');
                    }
                    // –ö–ª–∏–∫ –≤–Ω–µ –∞–≥–µ–Ω—Ç–∞ ‚Äî –∑–∞–∫—Ä—ã–≤–∞–µ–º
                    else if (!agentSidebar.contains(e.target) && agentSidebar.classList.contains('mobile-open')) {
                        agentSidebar.classList.remove('mobile-open');
                        document.body.classList.remove('agent-open');
                    }
                });
            }
        }

        function initTerminal() {
            const terminal = document.getElementById('live-terminal');
            terminalMessages.forEach(msg => {
                addTerminalLine(msg);
            });
        }

        function addTerminalLine(message) {
            const terminal = document.getElementById('live-terminal');
            const line = document.createElement('div');
            line.className = 'terminal-line';
            line.innerHTML = message;
            
            terminal.appendChild(line);
            terminal.scrollTop = terminal.scrollHeight;
            
            if (terminal.children.length > 15) {
                terminal.removeChild(terminal.firstChild);
            }
        }

        function initAgent() {
            const agentContainer = document.getElementById('agent-messages');
            
            agentMessagePool.slice(0, 3).forEach(msg => {
                addAgentMessage(msg.text, msg.type);
            });
        }

        function addAgentMessage(text, type = "system") {
            const agentContainer = document.getElementById('agent-messages');
            const message = document.createElement('div');
            message.className = `agent-message ${type} updating`;
            
            const timestamp = new Date().toLocaleTimeString('ru-RU', {hour12: false}).substring(0,5);
            
            message.innerHTML = `
                <div class="flex items-center gap-2 mb-1">
                    <span class="text-bright font-bold">${timestamp}</span>
                    <span class="text-muted">|</span>
                    <span class="${type === 'critical' ? 'text-error' : type === 'warning' ? 'text-warning' : type === 'info' ? 'text-info' : 'text-muted'}">
                        ${type === 'critical' ? '–ö–†–ò–¢–ò–ß–ï–°–ö–û–ï' : type === 'warning' ? '–ü–†–ï–î–£–ü–†–ï–ñ–î–ï–ù–ò–ï' : '–°–ò–°–¢–ï–ú–ê'}
                    </span>
                </div>
                <div>${text}</div>
            `;
            
            agentContainer.insertBefore(message, agentContainer.firstChild);
            
            setTimeout(() => {
                message.classList.remove('updating');
            }, 4000);
            
            if (agentContainer.children.length > 5) {
                agentContainer.removeChild(agentContainer.lastChild);
            }
        }

        function renderTable() {
            const tbody = document.getElementById('table-body');
            tbody.innerHTML = '';
            
            const inflation = parseFloat(document.getElementById('mat-inflation').value) / 100;
            const keyRate = parseFloat(document.getElementById('key-rate').value) / 100;
            
            projectsData.forEach(row => {
                let stressedRequest = row.request;
                if (row.type === 'mat') {
                    stressedRequest = row.request * (1 + inflation);
                }
                if (row.type === 'bank') {
                    stressedRequest = row.request * (1 + keyRate/12);
                }
                
                const b2bGap = (row.outgoing + stressedRequest) - row.incoming;
                const hasGap = b2bGap > 0.1 && row.type === 'sub';
                
                const isSelected = selectedIds.has(row.id);
                const isMandatory = row.type === 'bank' || row.type === 'tax';
                
                let riskBadge = `<span class="badge badge-success">–ù–ò–ó–ö–ò–ô</span>`;
                if (row.risk === 'high') riskBadge = `<span class="badge badge-error">–í–´–°–û–ö–ò–ô</span>`;
                if (row.risk === 'medium') riskBadge = `<span class="badge badge-warning">–°–†–ï–î–ù–ò–ô</span>`;
                if (hasGap) riskBadge = `<span class="badge badge-error">–†–ê–ó–†–´–í ${b2bGap.toFixed(1)}M</span>`;
                
                let statusIndicator = '<span class="status-dot status-ok"></span>–û–ö';
                if (row.status === 'critical') statusIndicator = '<span class="status-dot status-critical blink"></span>–ö–†–ò–¢–ò–ß';
                if (row.status === 'pending') statusIndicator = '<span class="status-dot status-warning"></span>–û–ñ–ò–î';
                
                const tr = document.createElement('tr');
                if (isSelected) tr.classList.add('selected');
                
                tr.innerHTML = `
                    <td style="text-align:center">
                        <input type="checkbox" ${isSelected ? 'checked' : ''} 
                               onchange="toggleSelection(${row.id})" 
                               ${isMandatory ? 'disabled' : ''}
                               style="accent-color: var(--terminal-info)">
                    </td>
                    <td>
                        <div class="font-bold text-bright">${row.proj}</div>
                        <div class="text-muted text-xs">ID: ${row.id.toString().padStart(3, '0')}</div>
                    </td>
                    <td>
                        <div class="font-bold">${row.agent}</div>
                        <div class="text-muted text-xs">${row.desc}</div>
                    </td>
                    <td class="text-muted">${row.budget.toFixed(1)}</td>
                    <td class="font-bold">${row.actual.toFixed(1)}</td>
                    <td class="text-success font-bold">+${row.incoming.toFixed(1)}</td>
                    <td class="text-error">-${row.outgoing.toFixed(1)}</td>
                    <td style="border-left: 2px solid var(--terminal-info); background: rgba(100, 116, 139, 0.03)" 
                        class="font-bold ${row.type === 'mat' ? 'text-warning' : 'text-info'}">
                        ${stressedRequest.toFixed(1)}
                    </td>
                    <td>
                        <span class="${row.due === '–°–µ–≥–æ–¥–Ω—è' || row.due === '–°–ï–ì–û–î–ù–Ø' ? 'text-error blink' : 'text-muted'}">
                            ${row.due}
                        </span>
                    </td>
                    <td>${statusIndicator}</td>
                    <td>${riskBadge}</td>
                `;
                
                tbody.appendChild(tr);
            });
        }

        function toggleSelection(id) {
            if (selectedIds.has(id)) {
                selectedIds.delete(id);
            } else {
                selectedIds.add(id);
            }
            
            const item = projectsData.find(p => p.id === id);
            if ((item.type === 'bank' || item.type === 'tax') && !selectedIds.has(id)) {
                selectedIds.add(id);
            }
            
            renderTable();
            updateAnalysis();
            
            addTerminalLine(`[${new Date().toLocaleTimeString('ru-RU', {hour12: false}).substring(0,8)}] –í–´–ë–û–†: –ü–ª–∞—Ç–µ–∂ #${id} ${selectedIds.has(id) ? '–¥–æ–±–∞–≤–ª–µ–Ω' : '—É–¥–∞–ª–µ–Ω'}`);
        }

        function recalculateAll() {
            renderTable();
            updateAnalysis();
            
            addTerminalLine(`[${new Date().toLocaleTimeString('ru-RU', {hour12: false}).substring(0,8)}] –ü–ê–†–ê–ú–ï–¢–†–´: –ö–ª—é—á–µ–≤–∞—è —Å—Ç–∞–≤–∫–∞=${document.getElementById('key-rate').value}%, –£–¥–æ—Ä–æ–∂–∞–Ω–∏–µ –º–∞—Ç.=${document.getElementById('mat-inflation').value}%`);
        }

        function updateAnalysis() {
            let totalSelected = 0;
            const inflation = parseFloat(document.getElementById('mat-inflation').value) / 100;
            const keyRate = parseFloat(document.getElementById('key-rate').value) / 100;
            
            projectsData.forEach(row => {
                if (selectedIds.has(row.id)) {
                    let amount = row.request;
                    if (row.type === 'mat') amount *= (1 + inflation);
                    if (row.type === 'bank') amount *= (1 + keyRate/12);
                    totalSelected += amount;
                }
            });
            
            document.getElementById('total-selected').textContent = totalSelected.toFixed(1) + ' M';
            document.getElementById('current-cash').textContent = currentCash.toFixed(1) + ' M';
            
            const forecast = currentCash - totalSelected;
            const forecastElement = document.getElementById('forecast-cash');
            forecastElement.textContent = forecast.toFixed(1) + ' M';
            
            const progressBar = document.getElementById('cash-progress');
            const progressPercent = Math.min(100, (currentCash / (totalSelected + currentCash)) * 100);
            progressBar.style.width = `${progressPercent}%`;
            
            progressBar.style.setProperty('--progress-width', `${progressPercent}%`);
            
            const alertBox = document.getElementById('alert-box');
            if (forecast < 0) {
                forecastElement.style.color = 'var(--terminal-error)';
                progressBar.style.background = 'var(--terminal-error)';
                
                if (Math.abs(forecast) > creditLimit) {
                    alertBox.textContent = '‚ö° –ü–†–ï–í–´–®–ï–ù–ò–ï_–ö–†–ï–î–ò–¢–ù–û–ì–û_–õ–ò–ú–ò–¢–ê';
                    alertBox.classList.remove('hidden');
                } else {
                    alertBox.textContent = `‚ö† –ö–ê–°–°–û–í–´–ô_–†–ê–ó–†–´–í: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ ${Math.abs(forecast).toFixed(1)}M –∫—Ä–µ–¥–∏—Ç–∞`;
                    alertBox.classList.remove('hidden');
                }
            } else {
                forecastElement.style.color = 'var(--terminal-ok)';
                progressBar.style.background = 'var(--terminal-ok)';
                alertBox.classList.add('hidden');
            }
            
            updateChart(forecast);
        }

        function updateChart(forecast) {
            const ctx = document.getElementById('liquidityChart').getContext('2d');
            
            const days = ['T+0', 'T+1', 'T+3', 'T+7', 'T+14', 'T+30'];
            const data = [
                currentCash,
                forecast,
                forecast + (Math.random() * 3 - 1),
                forecast + 5 + (Math.random() * 4 - 2),
                forecast + 8 + (Math.random() * 6 - 3),
                forecast + 12 + (Math.random() * 8 - 4)
            ];
            
            if (chartInstance) {
                chartInstance.destroy();
            }
            
            chartInstance = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: days,
                    datasets: [{
                        label: '–ü—Ä–æ–≥–Ω–æ–∑ –∫–∞—Å—Å—ã',
                        data: data,
                        borderColor: forecast < 0 ? 'var(--terminal-error)' : 'var(--terminal-ok)',
                        backgroundColor: forecast < 0 ? 'rgba(239, 68, 68, 0.1)' : 'rgba(16, 185, 129, 0.1)',
                        fill: true,
                        tension: 0.4,
                        borderWidth: 2,
                        pointRadius: 3,
                        pointBackgroundColor: forecast < 0 ? 'var(--terminal-error)' : 'var(--terminal-ok)'
                    }, {
                        label: '–ö—Ä–µ–¥–∏—Ç–Ω—ã–π –ª–∏–º–∏—Ç',
                        data: Array(days.length).fill(-creditLimit),
                        borderColor: 'rgba(239, 68, 68, 0.3)',
                        borderDash: [5, 5],
                        borderWidth: 1,
                        pointRadius: 0,
                        fill: false
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            backgroundColor: 'var(--surface)',
                            titleColor: 'var(--text-bright)',
                            bodyColor: 'var(--text-main)',
                            borderColor: 'var(--border)',
                            borderWidth: 1
                        }
                    },
                    scales: {
                        y: {
                            grid: { color: 'rgba(0, 0, 0, 0.05)' },
                            ticks: { 
                                color: 'var(--text-dim)',
                                font: { family: 'JetBrains Mono', size: 9 }
                            }
                        },
                        x: {
                            grid: { display: false },
                            ticks: { 
                                color: 'var(--text-dim)',
                                font: { size: 9 }
                            }
                        }
                    }
                }
            });
        }

        function startLiveUpdates() {
            setInterval(() => {
                const change = (Math.random() - 0.5) * 0.1;
                currentCash += change;
                
                document.getElementById('live-cash').textContent = formatCash(currentCash * 1000000);
                document.getElementById('current-cash').textContent = currentCash.toFixed(1) + ' M';
                
                updateAnalysis();
            }, 4000);
            
            setInterval(() => {
                const randomMsg = agentMessagePool[Math.floor(Math.random() * agentMessagePool.length)];
                addAgentMessage(randomMsg.text, randomMsg.type);
                
                addTerminalLine(`[${new Date().toLocaleTimeString('ru-RU', {hour12: false}).substring(0,8)}] ${randomMsg.type === 'critical' ? '–ö–†–ò–¢–ò–ß–ï–°–ö–û–ï' : randomMsg.type === 'warning' ? '–ü–†–ï–î–£–ü–†–ï–ñ–î–ï–ù–ò–ï' : '–°–ò–°–¢–ï–ú–ê'}: ${randomMsg.text.substring(0, 50)}...`);
            }, 4000);
            
            setInterval(() => {
                const currentInfl = parseFloat(document.getElementById('mat-inflation').value);
                const newInfl = Math.max(4.5, Math.min(7.5, currentInfl + (Math.random() - 0.5) * 0.2));
                document.getElementById('mat-inflation').value = newInfl.toFixed(1);
                
                addTerminalLine(`[${new Date().toLocaleTimeString('ru-RU', {hour12: false}).substring(0,8)}] –†–´–ù–û–ö: –£–¥–æ—Ä–æ–∂–∞–Ω–∏–µ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ ${newInfl > currentInfl ? '‚Üë' : '‚Üì'} ${newInfl.toFixed(1)}%`);
                recalculateAll();
            }, 8000);
        }

        function startDynamicUpdates() {
            setInterval(() => {
                updateDynamicValues();
            }, 4000);
        }

        function updateDynamicValues() {
            // –û–±–Ω–æ–≤–ª—è–µ–º –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ —á–∏—Å–ª–∞ –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª–∞—Ö –≤–∫–ª–∞–¥–æ–∫
            const dynamicNumbers = document.querySelectorAll('.dynamic-number');
            dynamicNumbers.forEach(el => {
                const currentText = el.textContent;
                const currentVal = parseFloat(currentText);
                if (!isNaN(currentVal)) {
                    let newVal;
                    
                    if (currentText.includes('%')) {
                        // –ü—Ä–æ—Ü–µ–Ω—Ç—ã
                        newVal = Math.min(100, Math.max(0, currentVal + (Math.random() - 0.5) * 2));
                        el.textContent = newVal.toFixed(0) + '%';
                    } else {
                        // –î–µ–Ω–µ–∂–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
                        const change = (Math.random() - 0.5) * 0.3;
                        newVal = Math.max(0, currentVal + change);
                        
                        if (currentText.includes('.')) {
                            el.textContent = newVal.toFixed(1);
                        } else {
                            el.textContent = newVal.toFixed(0);
                        }
                    }
                    
                    el.classList.add('updating');
                    setTimeout(() => el.classList.remove('updating'), 1000);
                }
            });
        }

        function formatCash(amount) {
            return amount.toFixed(0).replace(/\B(?=(\d{3})+(?!\d))/g, ",");
        }

        // Agent Functions
        function optimizePayments() {
            const btn = document.getElementById('optimize-btn');
            btn.classList.add('executing');
            
            setTimeout(() => {
                const sorted = [...projectsData].sort((a, b) => {
                    const priority = { 'tax': 0, 'bank': 1, 'sub': 2, 'mat': 3 };
                    return priority[a.type] - priority[b.type];
                });
                
                selectedIds.clear();
                sorted.forEach(item => {
                    if (item.type === 'tax' || item.type === 'bank') {
                        selectedIds.add(item.id);
                    } else if (currentCash > item.request * 2) {
                        selectedIds.add(item.id);
                    }
                });
                
                renderTable();
                updateAnalysis();
                addAgentMessage("–û—á–µ—Ä–µ–¥—å –ø–ª–∞—Ç–µ–∂–µ–π –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–∞. –ù–∞–ª–æ–≥–∏ –∏ –±–∞–Ω–∫–æ–≤—Å–∫–∏–µ –ø–ª–∞—Ç–µ–∂–∏ –ø—Ä–∏–æ—Ä–∏—Ç–µ–∑–∏—Ä–æ–≤–∞–Ω—ã.", "system");
                btn.classList.remove('executing');
            }, 2000);
        }

        function predictCashGap() {
            const btn = document.getElementById('predict-btn');
            btn.classList.add('executing');
            
            setTimeout(() => {
                const totalRequests = projectsData.reduce((sum, item) => sum + item.request, 0);
                const gapProbability = Math.min(100, Math.max(0, (totalRequests - currentCash) / creditLimit * 100));
                
                addAgentMessage(`–í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –∫–∞—Å—Å–æ–≤–æ–≥–æ —Ä–∞–∑—Ä—ã–≤–∞: ${gapProbability.toFixed(1)}%. –£—Ä–æ–≤–µ–Ω—å —Ä–∏—Å–∫–∞: ${gapProbability > 70 ? '–í–´–°–û–ö–ò–ô' : gapProbability > 40 ? '–°–†–ï–î–ù–ò–ô' : '–ù–ò–ó–ö–ò–ô'}`, 
                            gapProbability > 70 ? "critical" : "warning");
                btn.classList.remove('executing');
            }, 2000);
        }

        function suggestCollection() {
            const btn = document.getElementById('collect-btn');
            btn.classList.add('executing');
            
            setTimeout(() => {
                const overdueDebtors = projectsData.filter(p => 
                    p.incoming > 0 && (p.type === 'sub' || p.type === 'mat') && 
                    new Date().getDate() > 15
                );
                
                const totalOverdue = overdueDebtors.reduce((sum, p) => sum + p.incoming, 0);
                
                addAgentMessage(`–ò–Ω–∫–∞—Å—Å–∞—Ü–∏—è –¥–µ–±–∏—Ç–æ—Ä–∫–∏: ${overdueDebtors.length} –∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç–æ–≤, ${totalOverdue.toFixed(1)}M –≤—Å–µ–≥–æ. –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: ${overdueDebtors.slice(0, 2).map(d => d.agent).join(', ')}`, 
                            totalOverdue > 10 ? "warning" : "info");
                btn.classList.remove('executing');
            }, 2000);
        }

        function generateReport() {
            const btn = document.getElementById('report-btn');
            btn.classList.add('executing');
            
            setTimeout(() => {
                const now = new Date();
                const reportTime = now.toLocaleTimeString('ru-RU', {hour12: false});
                
                addAgentMessage(`–û—Ç—á–µ—Ç —Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω –≤ ${reportTime}. –ú–µ—Ç—Ä–∏–∫–∏: –ö–∞—Å—Å–∞=${currentCash.toFixed(1)}M, –ü–ª–∞—Ç–µ–∂–∏=${selectedIds.size}, –ü—Ä–æ–≥–Ω–æ–∑=${(currentCash - Array.from(selectedIds).reduce((sum, id) => sum + projectsData.find(p => p.id === id).request, 0)).toFixed(1)}M`, "info");
                
                addTerminalLine(`[${reportTime.substring(0,8)}] –û–¢–ß–ï–¢: –°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω –æ–ø–µ—Ä–∞—Ç–∏–≤–Ω—ã–π –æ—Ç—á–µ—Ç.`);
                btn.classList.remove('executing');
            }, 2000);
        }

        function switchTab(tabName) {
            document.querySelectorAll('.table-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            event.target.classList.add('active');
            
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            document.getElementById(`${tabName}-content`).classList.add('active');
            
            addTerminalLine(`[${new Date().toLocaleTimeString('ru-RU', {hour12: false}).substring(0,8)}] –ù–ê–í–ò–ì–ê–¶–ò–Ø: –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–æ –Ω–∞ ${tabName.toUpperCase()}`);
        }

        function commitPayments() {
            const total = Array.from(selectedIds).reduce((sum, id) => {
                const item = projectsData.find(p => p.id === id);
                return sum + (item ? item.request : 0);
            }, 0);
            
            currentCash -= total;
            
            addTerminalLine(`[${new Date().toLocaleTimeString('ru-RU', {hour12: false}).substring(0,8)}] –¢–†–ê–ù–ó–ê–ö–¶–ò–Ø: ${total.toFixed(1)}M –ø–ª–∞—Ç–µ–∂–µ–π –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –≤ –±–∞–Ω–∫`);
            
            selectedIds.clear();
            projectsData.forEach(item => {
                if (item.type === 'bank' || item.type === 'tax') {
                    selectedIds.add(item.id);
                }
            });
            
            renderTable();
            updateAnalysis();
            
            alert(`–†–µ–µ—Å—Ç—Ä –ø–ª–∞—Ç–µ–∂–µ–π —É—Ç–≤–µ—Ä–∂–¥–µ–Ω. ${total.toFixed(1)}M –ø–µ—Ä–µ–≤–µ–¥–µ–Ω–æ.`);
        }

        function runScenario() {
            const delay = parseInt(document.getElementById('sc-delay').value) || 0;
            const costs = parseInt(document.getElementById('sc-costs').value) || 0;
            const income = parseInt(document.getElementById('sc-income').value) || 0;
            
            const baseCash = 12.6;
            const basePayments = 4.7;
            
            const newCash = baseCash * (1 - income / 100);
            const newPayments = basePayments * (1 + costs / 100);
            const penalty = delay * 0.05;
            
            const forecast = newCash - newPayments - penalty;
            
            const el = document.getElementById('forecast-cash');
            el.textContent = forecast.toFixed(1) + ' M';
            el.style.color = forecast < 0 ? 'var(--terminal-error)' : forecast < 3 ? 'var(--terminal-warning)' : 'var(--terminal-ok)';
            
            document.getElementById('alert-box').classList.toggle('hidden', forecast >= 0);
            
            if (delay > 0 || costs > 0 || income > 0) {
                addTerminalLine(`[${new Date().toLocaleTimeString('ru-RU', {hour12: false}).substring(0,8)}] –°–¶–ï–ù–ê–†–ò–ô: –ó–∞–¥–µ—Ä–∂–∫–∞=${delay}–¥, –†–∞—Å—Ö–æ–¥—ã=+${costs}%, –î–æ—Ö–æ–¥=-${income}% ‚Üí ${forecast.toFixed(1)}M`);
            }
        }

        // Keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            if (e.ctrlKey && e.key === 'Enter') {
                e.preventDefault();
                commitPayments();
            }
            
            if (e.altKey && e.key === 'o') {
                e.preventDefault();
                optimizePayments();
            }
            
            if (e.key === 'Escape') {
                const nonMandatory = projectsData.filter(p => p.type !== 'bank' && p.type !== 'tax').map(p => p.id);
                nonMandatory.forEach(id => selectedIds.delete(id));
                renderTable();
                updateAnalysis();
            }
        });
    </script>
</body>
</html>